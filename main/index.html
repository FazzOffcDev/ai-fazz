<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FazzCodex AI Pro - Premium Chat</title>

<!-- Font & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Prism.js for Code Highlight -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prismjs/1.29.0/themes/prism-tomorrow.min.css" />

<style>
:root {
  --primary: #1a73e8;
  --accent: #00bcd4;
  --text: #e2e8f0;
  --text-light: #94a3b8;
  --border: rgba(255, 255, 255, 0.1);
  --glass-bg: rgba(255, 255, 255, 0.06);
  --radius: 18px;
  --shadow-glow: 0 0 25px rgba(26, 115, 232, 0.3);
}

body {
  font-family: "Inter", sans-serif;
  background: linear-gradient(135deg, #0a0f1c, #111a2f);
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  color: var(--text);
}

.chat-app {
  display: flex;
  flex: 1;
  margin: 10px;
  border-radius: var(--radius);
  background: var(--glass-bg);
  border: 1px solid var(--border);
  backdrop-filter: blur(16px);
  box-shadow: var(--shadow-glow);
  overflow: hidden;
}

/* Sidebar */
.sidebar {
  width: 250px;
  background: rgba(15, 23, 42, 0.85);
  display: flex;
  flex-direction: column;
  border-right: 1px solid var(--border);
  overflow-y: auto;
  transition: 0.3s;
}
.sidebar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 22px;
  font-weight: 700;
  color: var(--accent);
}
.nav-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.nav-list li a {
  display: flex;
  align-items: center;
  color: var(--text-light);
  padding: 12px 22px;
  text-decoration: none;
  transition: 0.3s;
}
.nav-list li a:hover {
  background: rgba(255, 255, 255, 0.05);
  color: var(--accent);
}
.nav-list li a.active {
  background: rgba(26, 115, 232, 0.15);
  color: var(--primary);
  font-weight: 600;
}
.nav-list li a i {
  width: 24px;
  margin-right: 12px;
}

.upgrade-box {
  background: linear-gradient(145deg, var(--primary), var(--accent));
  color: #fff;
  margin: 18px;
  padding: 12px;
  border-radius: var(--radius);
  text-align: center;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(26,115,232,0.25);
  transition: 0.3s;
}
.upgrade-box:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px rgba(26,115,232,0.35);
}

/* Main Chat */
.chat-main {
  display: flex;
  flex-direction: column;
  flex: 1;
  background: rgba(17, 25, 40, 0.6);
}

.chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 24px;
  border-bottom: 1px solid var(--border);
}

.chat-header img {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid var(--accent);
  margin-right: 10px;
}

.chat-header h3 {
  margin: 0;
  font-weight: 600;
}

.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  scroll-behavior: smooth;
}

.message {
  display: flex;
  margin-bottom: 20px;
}
.message-content {
  padding: 16px 20px;
  border-radius: var(--radius);
  max-width: 80%;
  line-height: 1.6;
}
.user .message-content {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: #fff;
  margin-left: auto;
}
.bot .message-content {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border);
  margin-right: auto;
}

/* Code block styling */
.code-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 8px 8px 0 0;
  padding: 6px 12px;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--accent);
  border-bottom: 1px solid var(--border);
}
.copy-button {
  background: none;
  border: none;
  color: var(--text);
  cursor: pointer;
  transition: 0.3s;
}
.copy-button:hover {
  color: var(--accent);
}
pre {
  margin: 0;
  padding: 14px;
  background: #1e1e2f;
  border-radius: 0 0 8px 8px;
  overflow-x: auto;
}
pre code {
  font-size: 0.95rem;
}

/* Input area */
.input-area {
  display: flex;
  align-items: center;
  padding: 18px;
  border-top: 1px solid var(--border);
}
.input-area input {
  flex: 1;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid var(--border);
  border-radius: 50px;
  padding: 14px 20px;
  color: var(--text);
  outline: none;
}
.send-button {
  width: 50px;
  height: 50px;
  margin-left: 12px;
  border-radius: 50%;
  background: var(--primary);
  border: none;
  color: #fff;
  font-size: 1.3rem;
  cursor: pointer;
  transition: 0.3s;
}
.send-button:hover {
  transform: scale(1.08);
  background: var(--accent);
}

@media (max-width: 900px) {
  .sidebar {
    position: fixed;
    top: 0;
    left: -260px;
    height: 100%;
    z-index: 1000;
  }
  .sidebar.active { left: 0; }
  .chat-app { flex-direction: column; }
}
</style>
</head>

<body>
<div class="chat-app">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <span>FazzCodex Pro</span>
  <button style="margin-left:auto;background:none;border:0;color:var(--text-light);cursor:pointer" id="toggleSidebar"><i class="fas fa-bars"></i></button>
    </div>
    <ul class="nav-list">
      <li><a href="https://trakteer.id/fazzcodex/tip" class="active"><i class="fas fa-comments"></i>Donasi</a></li>
      <li><a href="https://t.me/fazzcodex"><i class="fas fa-plus-circle"></i>Contact Dev</a></li>
      <li><a href="https://t.me/fazzinformation"><i class="fas fa-clock-rotate-left"></i>Komunitas</a></li>
    </ul>
    <div class="upgrade-box">ðŸš€ Upgrade ke Premium</div>
  </aside>

  <main class="chat-main">
    <header class="chat-header">
      <div style="display:flex; align-items:center;">
        <img src="https://napkinsdev.s3.us-east-1.amazonaws.com/next-s3-uploads/5270c929-2208-401d-ae7b-af4b382d4fb7/1761563150087.webp" alt="AI">
        <div>
          <h3>Asisten Kode Fazz</h3>
          <small style="color:var(--accent)">Online</small>
        </div>
      </div>
      <button class="hamburger-btn mobile" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    </header>

    <div class="chat-container" id="chatBox">
      <div class="message bot">
        <div class="message-content">
          ðŸ‘‹ Halo! Selamat datang di <b>FazzCodex Ai Pro</b>.<br>
         
        </div>
      </div>
    </div>

    <div class="input-area">
      <input type="text" id="messageInput" placeholder="Ketik pesan di sini...">
      <button class="send-button" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
  </main>
</div>

<!-- Prism.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prismjs/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prismjs/1.29.0/components/prism-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prismjs/1.29.0/components/prism-python.min.js"></script>

<script>
        // =======================================================
        //                       LOGIKA JAVASCRIPT
        // =======================================================

        const chatBox = document.getElementById('chatBox');
        const messageInput = document.getElementById('messageInput');
        const sidebar = document.getElementById('sidebar');
        
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user-' + Math.random().toString(36).substring(2, 9);
            localStorage.setItem('userId', userId);
        }

        let isTyping = false;
        
        function toggleSidebar() {
            if (window.innerWidth <= 900) {
                 sidebar.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }
        function showTyping() {
  const t = document.createElement("div");
  t.className = "typing"; t.id = "typing";
  t.innerHTML = "<span></span><span></span><span></span>";
  chatBox.appendChild(t);
  chatBox.scrollTop = chatBox.scrollHeight;
}
function hideTyping() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}
        function copyCode(buttonElement) {
            const pre = buttonElement.closest('.message-content').querySelector('pre');
            if (!pre || !navigator.clipboard) {
                 alert('Gagal menyalin.');
                 return;
            }
            
            const codeText = pre.textContent.trim();
            navigator.clipboard.writeText(codeText).then(() => {
                const originalText = buttonElement.innerHTML;
                buttonElement.innerHTML = '<i class="fas fa-check"></i> Disalin!';
                setTimeout(() => {
                    buttonElement.innerHTML = originalText;
                }, 2000);
            });
        }
        
        function typeMessage(targetElement, fullText, delay = 10) { 
            return new Promise(resolve => {
                let charIndex = 0;
                const cursor = document.createElement('span');
                cursor.classList.add('typing-cursor');
                targetElement.appendChild(cursor);
                
                const typingInterval = setInterval(() => {
                    if (charIndex < fullText.length) {
                        targetElement.insertBefore(document.createTextNode(fullText[charIndex]), cursor);
                        charIndex++;
                        chatBox.scrollTop = chatBox.scrollHeight;
                    } else {
                        clearInterval(typingInterval);
                        targetElement.removeChild(cursor);
                        resolve();
                    }
                }, delay);
            });
        }

        async function displayMessage(message, sender) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('message', sender);
            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            const parts = message.split('```');

            if (sender === 'user') {
                const textDiv = document.createElement('div');
                textDiv.classList.add('text-content');
                textDiv.textContent = message;
                messageContent.appendChild(textDiv);
                messageWrapper.appendChild(messageContent);
                chatBox.appendChild(messageWrapper);
                chatBox.scrollTop = chatBox.scrollHeight;
                return;
            }
            
            messageWrapper.appendChild(messageContent);
            chatBox.appendChild(messageWrapper);
            
            for (let i = 0; i < parts.length; i++) {
                if (i % 2 === 0) {
                    if (parts[i].trim()) {
                        const textDiv = document.createElement('div');
                        textDiv.classList.add('text-content');
                        messageContent.appendChild(textDiv);
                        await typeMessage(textDiv, parts[i].trim());
                    }
                } else {
                    const codeBlock = parts[i].trim();
                    if (codeBlock) {
                        const lines = codeBlock.split('\n');
                        const language = lines[0].split(' ')[0] || 'Code';
                        const actualCode = lines.slice(1).join('\n').trim();

                        const codeHeader = document.createElement('div');
                        codeHeader.classList.add('code-header');
                        codeHeader.innerHTML = `
                            <span>${language.toUpperCase()}</span>
                            <button class="copy-button" onclick="copyCode(this)">
                                <i class="fas fa-copy"></i> Salin
                            </button>
                        `;
                        messageContent.appendChild(codeHeader);

                        const pre = document.createElement('pre');
                        const code = document.createElement('code');
                        code.textContent = actualCode;
                        pre.appendChild(code);
                        messageContent.appendChild(pre);
                        
                        chatBox.scrollTop = chatBox.scrollHeight;
                        await new Promise(r => setTimeout(r, 200)); 
                    }
                }
            }
            isTyping = false; 
        }

        // =======================================================
        // FUNGSI INI SUDAH DIPERBAIKI (MENGHILANGKAN SIMULASI)
        // =======================================================
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isTyping) return; 

            // Tutup sidebar mobile
            if (window.innerWidth <= 900 && sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }

            displayMessage(message, 'user'); 
            messageInput.value = '';
            isTyping = true; 

            const apiUrl = '/chat'; 
            const payload = JSON.stringify({ message: message, sessionId: userId });
            let botReply = "Maaf, server tidak merespons. Pastikan backend Anda berjalan di '/chat'."; // Default error message
            
            try {
                // --- PANGGILAN API ASLI ---
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: payload
                });
      hideTyping();
                if (!response.ok) {
                    // Jika server merespons dengan status error (4xx, 5xx)    hideTyping();
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                hideTyping();
                botReply = data.reply || "Server merespons, tetapi balasan tidak valid.";
                
            } catch (error) {
                console.error('Error saat menghubungi API:', error);
                
                // --- FALLBACK/DEBUG SIMULATION (HANYA UNTUK DEBUGGING) ---
                // Jika server tidak ditemukan, gunakan data tiruan untuk demonstrasi bahwa UI bekerja.
                botReply = `[DEBUG MODE: Koneksi ke ${apiUrl} GAGAL. Pesan Anda: "${message}".] 
                
Berikut adalah contoh struktur API yang ideal:

\`\`\`json
{
  "sessionId": "${userId}",
  "input": "${message}",
  "reply": "Balasan AI yang unik sesuai input Anda."
}
\`\`\`
Periksa apakah backend Anda sudah berjalan dan menerima POST request pada endpoint '/chat'.`;
                // --------------------------------------------------------

            } finally {
                hideTyping();
                await displayMessage(botReply, 'bot');
                isTyping = false; 
            }
        }
        // =======================================================
        
        messageInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); 
                hideTyping();
                sendMessage();
            }
        });
        
        window.onload = function() {
            if (window.innerWidth > 900 && window.innerWidth <= 1200) {
                 sidebar.classList.add('collapsed');
            }
        }
</script>
</body>
</html>
